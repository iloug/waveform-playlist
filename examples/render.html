<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Drawer Tests</title>
<style>

#meter-wrapper {
  width: 100%;
  border:1px solid red;
}
#meter {
  width: 0%;
  height: 15px;
  margin: 2px 0;
  background: green;
  border: red;
  -webkit-transition: width .05s;
}
</style>

<script type="text/javascript" src="../src/loader.js"></script>
<script type="text/javascript" src="../src/render.js"></script>
<script type="text/javascript" src="../src/playout.js"></script>

</head>
<body>
  
  <div id=waveform></div>

  <div id=play onclick="playout.play()">Play</div>
  <div id=pause onclick="playout.resume()">Resume</div>
  <div id=pause onclick="playout.pause()">Pause</div>
  <div id=stop onclick="playout.stop()">Stop</div>

<script type="text/javascript">
(function(){

    var BUFFERS_TO_LOAD = {
        test:'Beautiful.m4a'
    };

    var ctx = new webkitAudioContext(), 
        buffer;

    var onAudioLoad = function(buffers) {

        drawer.init({
            buffer:buffers["test"],
            container: document.getElementById("waveform"),
            resolution: 6000
        });
        var peaks = drawer.getPeaks();
        drawer.draw();

        playout.init({
            context: ctx,
            buffer:buffers["test"]
        });

        playout.onAudioUpdate(function(e){
            drawer.updateCursor(playout.getPlayedPercents());
        });

        window.playout = playout;  
    };

    var bufferLoader = new BufferLoader();
    bufferLoader.init({
        context: ctx,
        onComplete: onAudioLoad
    });
    bufferLoader.loadAudio(BUFFERS_TO_LOAD);

    var drawer = new WaveformDrawer();
    var playout = new AudioPlayout();
  
})();
</script>
</body>
</html>
